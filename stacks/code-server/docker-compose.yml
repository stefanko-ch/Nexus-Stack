# =============================================================================
# code-server - VS Code in the Browser
# =============================================================================
# Access via: https://code.${domain}
# Run VS Code on a remote server and access it through the browser for
# consistent development environments accessible from any device.
#
# Note: Password authentication is disabled (--auth none) since Cloudflare
# Access provides email OTP protection at the network level.
# =============================================================================

services:
  code-server:
    image: ${IMAGE_CODE_SERVER:-codercom/code-server:4}
    container_name: code-server
    restart: unless-stopped
    command: ["--auth", "none", "--bind-addr", "0.0.0.0:8080"]
    ports:
      - "8100:8080"
    volumes:
      - code-server-data:/home/coder
    networks:
      - app-network
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8080/healthz || exit 1"]
      interval: 15s
      timeout: 5s
      retries: 3
      start_period: 10s

volumes:
  code-server-data:

networks:
  app-network:
    external: true
