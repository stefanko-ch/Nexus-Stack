# =============================================================================
# Marimo - Reactive Python Notebook
# https://marimo.${DOMAIN}
# =============================================================================
# Marimo is a reactive Python notebook that's reproducible, git-friendly,
# and deployable as apps. SQL variant includes DuckDB and data analysis tools.
#
# Git Integration: If Gitea is enabled, the shared workspace repo is
# auto-cloned into /app/notebooks/.
# =============================================================================

services:
  marimo:
    image: ${IMAGE_MARIMO:-ghcr.io/marimo-team/marimo:latest-sql}
    container_name: marimo
    restart: unless-stopped
    entrypoint: >
      sh -c "
        if [ -n \"$$GITEA_REPO_URL\" ] && [ ! -d /app/notebooks/$$REPO_NAME/.git ]; then
          apk add --no-cache git 2>/dev/null || true;
          git clone \"$$GITEA_REPO_URL\" /app/notebooks/$$REPO_NAME 2>/dev/null || true;
        fi;
        exec marimo edit --host 0.0.0.0 --port 8080 /app/notebooks
      "
    env_file:
      - path: .env
        required: false
    ports:
      - "2718:8080"
    environment:
      - HOST=0.0.0.0
      - PORT=8080
    volumes:
      - marimo_data:/app/notebooks
    networks:
      - app-network

volumes:
  marimo_data:

networks:
  app-network:
    external: true
