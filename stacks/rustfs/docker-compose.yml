# =============================================================================
# RustFS - Rust-based S3-Compatible Object Storage
# =============================================================================
# High-performance MinIO alternative written in Rust
# Accessible via: https://rustfs.<domain>
#
# Port: 9003 (Console), 9002 (S3 API)
#
# Default credentials:
#   Access Key: ${RUSTFS_ACCESS_KEY}
#   Secret Key: Generated by OpenTofu (stored in Infisical)
#
# Documentation: https://docs.rustfs.com
# =============================================================================

services:
  rustfs:
    image: ${IMAGE_RUSTFS:-rustfs/rustfs:latest}
    container_name: rustfs
    restart: unless-stopped
    user: "10001:10001"
    ports:
      - "9003:9003"  # Web Console
      - "9002:9002"  # S3 API
    env_file: .env
    environment:
      # RustFS uses RUSTFS_ACCESS_KEY/SECRET_KEY (not ROOT_USER/PASSWORD)
      RUSTFS_ACCESS_KEY: ${RUSTFS_ACCESS_KEY:-nexus-rustfs}
      RUSTFS_SECRET_KEY: ${RUSTFS_SECRET_KEY}
      RUSTFS_ADDRESS: "0.0.0.0:9002"
      RUSTFS_CONSOLE_ADDRESS: "0.0.0.0:9003"
      RUSTFS_CONSOLE_ENABLE: "true"
    command: server /data
    volumes:
      - rustfs_data:/data
    networks:
      - app-network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://127.0.0.1:9002/minio/health/live"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s

volumes:
  rustfs_data:

networks:
  app-network:
    external: true
