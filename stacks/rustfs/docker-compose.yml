# =============================================================================
# RustFS - Rust-based S3-Compatible Object Storage
# =============================================================================
# High-performance MinIO alternative written in Rust
# Accessible via: https://rustfs.<domain>
#
# Port: 9003 (Console), 9002 (S3 API)
#
# Default credentials:
#   Access Key: ${RUSTFS_ACCESS_KEY}
#   Secret Key: Generated by OpenTofu (stored in Infisical)
#
# Documentation: https://docs.rustfs.com
# =============================================================================

services:
  rustfs:
    image: ${IMAGE_RUSTFS:-rustfs/rustfs:latest}
    container_name: rustfs
    restart: unless-stopped
    ports:
      - "9003:9003"  # Web Console
      - "9002:9002"  # S3 API
    env_file: .env
    environment:
      RUSTFS_ROOT_USER: ${RUSTFS_ACCESS_KEY:-nexus-rustfs}
      RUSTFS_ROOT_PASSWORD: ${RUSTFS_SECRET_KEY}
      RUSTFS_ADDRESS: ":9002"
      RUSTFS_CONSOLE_ADDRESS: ":9003"
    command: server /data --console-address :9003
    volumes:
      - rustfs_data:/data
    networks:
      - app-network
    # Note: RustFS minimal image doesn't include curl/wget for health checks
    # Service health is monitored via Docker restart policy

volumes:
  rustfs_data:

networks:
  app-network:
    external: true
