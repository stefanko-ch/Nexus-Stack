# =============================================================================
# Nexus-Stack Configuration
# =============================================================================
# This file contains NON-SENSITIVE configuration only.
# Secrets are provided via environment variables (see .env.example)
#
# Setup:
#   1. Copy this file to config.tfvars
#   2. Copy .env.example to .env and add your secrets
#   3. Run 'source .env && make init'
#
# For CI/CD: Set secrets as GitHub Actions secrets (TF_VAR_*)
# =============================================================================

# =============================================================================
# Hetzner Cloud Server Settings
# =============================================================================

server_name     = "nexus"
server_type     = "cax31"         # ~€14/month - 8 vCPU, 16GB RAM (ARM)
server_location = "fsn1"          # Falkenstein, Germany
server_image    = "ubuntu-24.04"

# SSH keys (adjust paths if needed)
ssh_public_key_path  = "~/.ssh/id_ed25519.pub"
ssh_private_key_path = "~/.ssh/id_ed25519"

# =============================================================================
# Cloudflare Settings
# =============================================================================

# Get your Zone ID from: Cloudflare Dashboard → Your Domain → Overview (right sidebar)
cloudflare_zone_id = "YOUR_ZONE_ID_HERE"

# Your domain (must be managed in Cloudflare)
domain = "your-domain.com"

# Your email for Cloudflare Access (only this email can access services)
admin_email = "your@email.com"

# Admin username for services like Portainer, Uptime Kuma (optional, default: admin)
# admin_username = "admin"

# Authentication methods
# ⚠️ NOTE: Currently only email OTP is supported via Terraform
# For GitHub/Google OAuth, configure Identity Providers manually in Cloudflare Dashboard
auth_methods = {
  email         = true   # Email OTP (default - requires email verification each time) ✅ Supported
  github        = false  # GitHub OAuth (⚠️ requires manual Identity Provider setup in Dashboard)
  google        = false  # Google OAuth (⚠️ requires manual Identity Provider setup in Dashboard)
  service_token = false  # Service tokens for CI/CD (no browser needed) ✅ Supported
}

# GitHub organization name (not yet used - configure manually in Cloudflare Dashboard)
# github_org = "your-github-org"

# =============================================================================
# Services
# =============================================================================
# Add services here - each one gets automatic:
# - DNS record (subdomain.your-domain.com)
# - Cloudflare Tunnel routing
# - Zero Trust Access policy
#
# You still need to create stacks/<name>/docker-compose.yml for each service!
# =============================================================================

services = {
  it-tools = {
    enabled   = true
    subdomain = "it-tools"
    port      = 8080
    public    = false    # false = requires login, true = public access
  }

  portainer = {
    enabled   = true
    subdomain = "portainer"
    port      = 9090
    public    = false    # Docker management should always be protected
  }

  uptime-kuma = {
    enabled   = true
    subdomain = "uptime-kuma"
    port      = 3001
    public    = false
  }

  infisical = {
    enabled   = true
    subdomain = "infisical"
    port      = 8070
    public    = false    # Secret management - always protected
  }

  grafana = {
    enabled   = true
    subdomain = "grafana"
    port      = 3100
    public    = false    # Observability stack - always protected
  }

  info = {
    enabled   = true
    subdomain = "info"
    port      = 8090
    public    = false    # Landing page with service overview
  }

  kestra = {
    enabled   = true
    subdomain = "kestra"
    port      = 8085
    public    = false    # Workflow orchestration - always protected
  }
  
  # Example: Add more services like this:
  # excalidraw = {
  #   enabled   = true
  #   subdomain = "draw"
  #   port      = 8082
  #   public    = false
  # }
}
